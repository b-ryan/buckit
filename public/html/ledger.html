<div class="ledger" ng-controller="LedgerCtrl">
  <div class="container-fluid">
    <div class="col-xs-9">
    </div>
    <div class="col-xs-3">
      <select class="form-control"
              ng-model="account"
              ng-options="account.name for account in accounts">
      </select>
    </div>
  </div>
  <div class="transactions-view">
    <div class="container-fluid">
      <strong class="col-xs-1">Id</strong>
      <strong class="col-xs-2">Date</strong>
      <strong class="col-xs-3">Payee</strong>
      <strong class="col-xs-3">Category</strong>
      <strong class="col-xs-1">Amount</strong>
      <strong class="col-xs-2">Status</strong>
    </div>
    <div ng-repeat="transaction in transactions | filter:hasSplitForAccount">

      <div class="transaction-container" ng-controller="EditTransactionCtrl">
        <div class="container-fluid transaction-row-view" ng-if="!editing" ng-click="edit()">
          <div class="col-xs-1">{{transaction.id}}</div>
          <div class="col-xs-2">{{transaction.date | date:'yyyy-MM-dd'}}</div>
          <div class="col-xs-3">{{transaction.payee.name}}</div>
          <div class="col-xs-3">
            <div ng-show="non_account_splits.length > 1">Splits</div>
            <div ng-hide="non_account_splits.length > 1">
              {{non_account_splits[0].account.name}}
            </div>
          </div>
          <div class="col-xs-1">{{account_split.amount | currency}}</div>
          <div class="col-xs-2">{{account_split.reconciled_status}}</div>
        </div>
        <div class="transaction-row-edit" ng-if="editing">
          <div class="container-fluid">
            <div class="col-xs-1">{{transaction.id}}</div>
            <div class="col-xs-2">
              <div class="input-group">
                <input class="form-control" type="text"
                       ng-model="transaction.date"
                       datepicker-popup="yyyy-MM-dd"
                       is-open="datePicker.isOpen">
                <div class="input-group-btn">
                  <button class="btn btn-default" ng-click="openDatePicker($event)">
                    <i class="glyphicon glyphicon-calendar"></i>
                   </button>
                </div>
              </div>
            </div>
            <div class="col-xs-3">
              <select-payee ng-model="transaction.payee_id"></select-payee>
            </div>

            <div class="col-xs-3">
              <div class="form-control">
                {{account.name}}
              </div>
              <div ng-repeat="split in non_account_splits">
                <select-account ng-model="split.account_id"></select-account>
              </div>
            </div>

            <div class="col-xs-1">
              <div ng-repeat="split in transaction.splits">
                <input class="form-control" ng-model="split.amount">
              </div>
            </div>

            <div class="col-xs-2">
              <select class="form-control"
                ng-options="s for s in reconciled_statuses"
                ng-model="account_split.reconciled_status">
              </select>
            </div>

          </div>

          <div class="pull-right">
            <button class="btn btn-xs" ng-click="addSplit()">Add split</button>
            <button class="btn btn-xs btn-danger" ng-click="cancel()">Cancel</button>
            <button class="btn btn-xs btn-success" ng-click="save()">Save</button>
          </div>
        </div>

      </div>

    </div>
  </div>

  <div>
    <button class="btn" ng-click="addTransaction()">Add transaction</button>
  </div>
</div>
